# task_switch

在协程运行之前，先把栈赋给协程，后续如若主动让权，则再归还，在期间如果执行同步的 yield，以及抢占，与原本的切换相同。根据下一个任务的类型进行不同的操作。

协程 -> 协程：将 prev 的栈赋给 next
协程 -> 线程：将 prev 的栈放回到，不保存上一个任务的上下文，恢复下一个任务的上下文
线程 -> 协程：从 stack_poll 中取出栈，赋给 next，并且从 task_entry 开始执行
线程 -> 线程：无需进行栈的操作，直接进行上下文切换

避免了 schedule 的代码不属于任何一个任务。


